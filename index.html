<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #menu {
        position: fixed;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 20px;
        border-radius: 15px;
        color: white;
        font-family: sans-serif;
        z-index: 999;
        text-align: center;
        width: 80%;
        max-width: 400px;
        display: none;
      }
      #menu button {
        margin: 8px;
        padding: 8px 15px;
        border: none;
        border-radius: 10px;
        background: #1e90ff;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }
      #menu button:hover { background: #4682b4; }
      #story-box { margin-top: 10px; font-size: 15px; line-height: 1.4; }

      #scan-message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.75);
        padding: 12px 18px;
        border-radius: 12px;
        color: white;
        font-family: sans-serif;
        z-index: 1000;
        text-align: center;
      }
      #scan-message img {
        display: block;
        margin: 10px auto 0 auto;
        max-width: 150px;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <!-- Mensaje inicial -->
    <div id="scan-message">
      Escanea una de las pÃ¡ginas del cuento con tu cÃ¡mara para comenzar ðŸ“–
      <img id="scan-image" src="./page1.png" alt="PÃ¡gina del cuento">
    </div>

    <!-- Cuadro con el texto del cuento -->
    <div id="menu">
      <div id="story-box"></div>
    </div>

    <!-- Escena de A-Frame y MindAR -->
    <a-scene
      mindar-image="imageTargetSrc: ./cuento1.mind; maxTrack: 1"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <!-- Modelos del cuento -->
        <a-asset-item id="PageModel1" src="./escena1.glb"></a-asset-item>
        <a-asset-item id="PageModel2" src="./escena2.glb"></a-asset-item>
        <a-asset-item id="PageModel3" src="./escena3.glb"></a-asset-item>
        <a-asset-item id="PageModel4" src="./escena4.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- PÃ¡gina 1 -->
      <a-entity id="target-page1" mindar-image-target="targetIndex: 0">
        <a-entity gltf-model="#PageModel1"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>

      <!-- PÃ¡gina 2 -->
      <a-entity id="target-page2" mindar-image-target="targetIndex: 1">
        <a-entity gltf-model="#PageModel2"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>

      <!-- PÃ¡gina 3 -->
      <a-entity id="target-page3" mindar-image-target="targetIndex: 2">
        <a-entity gltf-model="#PageModel3"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>

      <!-- PÃ¡gina 4 -->
      <a-entity id="target-page4" mindar-image-target="targetIndex: 3">
        <a-entity gltf-model="#PageModel4"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      const storyBox = document.querySelector("#story-box");
      const menu = document.querySelector("#menu");
      const scanMessage = document.querySelector("#scan-message");
      const scanImage = document.querySelector("#scan-image");

      // ðŸ§¾ Cuento dividido por pÃ¡ginas
      const storyPages = [
        "HabÃ­a una vez un ratoncito llamado Milo, que vivÃ­a en una madriguera cÃ¡lida bajo un roble viejo. Le encantaba salir por las noches a buscar semillasâ€¦ pero habÃ­a algo que lo asustaba: La Luna.",
        "Grande, blanca y redonda, lo miraba desde lo alto con un brillo tan intenso que Milo sentÃ­a que lo estaba juzgando. â€”Seguro se rÃ­e de mÃ­ porque soy pequeÃ±oâ€¦ â€”pensaba mientras corrÃ­a a esconderse entre las hojas.",
        "Una noche, mientras huÃ­a apresurado, tropezÃ³ con una luciÃ©rnaga que brillaba tranquilamente sobre una piedra.
â€”Â¿Por quÃ© corres asÃ­? â€”preguntÃ³ la luciÃ©rnaga.
â€”La Luna me mira â€”susurrÃ³ Milo temblando.
La luciÃ©rnaga soltÃ³ una risita luminosa.
â€”Â¿Y quÃ© tiene de malo que alguien te mire? Tal vez no te estÃ¡ mirando para juzgarteâ€¦ sino para acompaÃ±arte.",
        "4. Milo se quedÃ³ pensando. Esa noche decidiÃ³ no esconderse. Se sentÃ³ en el pasto y mirÃ³ hacia el cielo.
La Luna, muy despacio, brillÃ³ aÃºn mÃ¡s fuerteâ€¦ como si le sonriera.
Y Milo, por primera vez, le sonriÃ³ tambiÃ©n.
Desde entonces, el pequeÃ±o ratÃ³n siguiÃ³ sintiendo miedo a veces, pero habÃ­a aprendido algo importante: La valentÃ­a no es no tener miedoâ€¦ es atreverse a mirar al miedo a los ojos y sonreÃ­rle de vuelta."
      ];

      function showPageText(index) {
        storyBox.innerText = storyPages[index];
        menu.style.display = "block";
        scanMessage.style.display = "none";
      }

      function hideAll() {
        menu.style.display = "none";
        scanMessage.style.display = "block";
      }


      document.querySelector("#target-page1").addEventListener("targetFound", () => showPageText(0));
      document.querySelector("#target-page2").addEventListener("targetFound", () => showPageText(1));
      document.querySelector("#target-page3").addEventListener("targetFound", () => showPageText(2));
      document.querySelector("#target-page4").addEventListener("targetFound", () => showPageText(3));

      // Si se pierde el marcador, ocultar texto
      ["#target-page1","#target-page2","#target-page3","#target-page4"].forEach(id => {
        document.querySelector(id).addEventListener("targetLost", hideAll);
      });

      // ðŸ”„ Cambiar imagen de escaneo
      const scanImages = ["./page1.png","./page2.png","./page3.png","./page4.png"];
      let scanIndex = 0;
      setInterval(() => {
        scanIndex = (scanIndex + 1) % scanImages.length;
        scanImage.src = scanImages[scanIndex];
      }, 2000);
    </script>
  </body>
</html>


