<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&display=swap" rel="stylesheet">

    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: 'IM Fell English SC', serif;
      }

      #scanning-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.85);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 1.3em;
        z-index: 9999;
        transition: opacity 0.6s ease;
        opacity: 1;
      }

      .hidden {
        opacity: 0;
        pointer-events: none;
      }

      .dot-loader {
        display: flex;
        gap: 0.4em;
        margin-top: 1em;
      }

      .dot-loader span {
        width: 10px;
        height: 10px;
        background: white;
        border-radius: 50%;
        animation: blink 1.4s infinite ease-in-out both;
      }

      .dot-loader span:nth-child(1) { animation-delay: 0s; }
      .dot-loader span:nth-child(2) { animation-delay: 0.2s; }
      .dot-loader span:nth-child(3) { animation-delay: 0.4s; }

      @keyframes blink {
        0%, 80%, 100% { opacity: 0.3; }
        40% { opacity: 1; }
      }

      #next-page-btn {
        position: absolute;
        bottom: 30px;
        right: 30px;
        padding: 10px 18px;
        font-size: 1.1em;
        border: none;
        border-radius: 6px;
        background-color: #FFD700;
        color: #222;
        font-family: 'IM Fell English SC', serif;
        cursor: pointer;
        z-index: 9999;
        display: none;
        transition: background-color 0.3s;
      }

      #next-page-btn:hover {
        background-color: #FFC300;
      }

       .hidden {
    display: none !important;
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const sceneEl = document.querySelector("a-scene");
        const overlay = document.querySelector("#scanning-overlay");
        const nextBtn = document.querySelector("#next-page-btn");

        let currentPage = 0;
        const totalPages = 4; 

        sceneEl.addEventListener("loaded", () => {
          const targets = sceneEl.querySelectorAll("[mindar-image-target]");

          targets.forEach((target, index) => {
            target.setAttribute("visible", index === currentPage);
          });

          const typeWriter = (text, element, speed = 40) => {
            let i = 0;
            const interval = setInterval(() => {
              if (i <= text.length) {
                element.setAttribute("value", text.substring(0, i));
                i++;
              } else {
                clearInterval(interval);
              }
            }, speed);
          };

          targets.forEach((target, index) => {
            const container = target.querySelector(".text-container");
            const textEntity = container.querySelector("a-text");

            target.addEventListener("targetFound", () => {
              overlay.classList.add("hidden");
              container.setAttribute("visible", true);
              container.emit("show");

              const fullText = textEntity.getAttribute("data-fulltext");
              textEntity.setAttribute("value", "");
              typeWriter(fullText, textEntity, 40);

              nextBtn.style.display = "block";
            });

            target.addEventListener("targetLost", () => {
              overlay.classList.remove("hidden");
              container.setAttribute("visible", false);
              nextBtn.style.display = "none";
            });
          });

          nextBtn.addEventListener("click", () => {
            const targets = sceneEl.querySelectorAll("[mindar-image-target]");
            targets[currentPage].setAttribute("visible", false);

            currentPage = (currentPage + 1) % totalPages; // Cicla entre 0 y 3
            targets[currentPage].setAttribute("visible", true);

            overlay.classList.remove("hidden");
            nextBtn.style.display = "none";
          });
        });
      });
    </script>
  </head>

  <body>
    <div id="scanning-overlay">
      Escaneando página del cuento...
      <div class="dot-loader"><span></span><span></span><span></span></div>
    </div>

    <button id="next-page-btn">Siguiente página ➜</button>

    <a-scene
     mindar-image="uiScanning: #scanning-overlay; imageTargetSrc: ./cuento1.mind; maxTrack: 1"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
    >
      <a-camera position="0 0 0" look-controls="enabled: false"
        cursor="fuse: false; rayOrigin: mouse;" raycaster="objects: .clickable">
      </a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity class="text-container" visible="false" opacity="0"
          position="-0.55 -0.35 0"
          animation__fade="property: opacity; to: 1; dur: 1000; easing: easeOutCubic; startEvents: show"

          <a-plane color="#222" width="1.3" height="0.35" opacity="0.5" material="side: double"></a-plane>
          <a-plane color="#FFD700" width="1.34" height="0.39" position="0 0 -0.01"></a-plane>

          <a-text
            data-fulltext="Habia una vez un ratoncito llamado Mauro, que vivia en una madriguera calida bajo un roble viejo. Le encantaba salir por las noches a buscar semillas… pero habia algo que lo asustaba:
La Luna."
            color="#FFF5CC" align="left" width="1.2" position="-0.6 0.05 0.01"
            font="https://cdn.aframe.io/fonts/DejaVu-sdf.fnt"
          ></a-text>
        </a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 1">
        <a-entity class="text-container" visible="false" opacity="0"
          position="-0.55 -0.35 0"
          animation__fade="property: opacity; to: 1; dur: 1000; easing: easeOutCubic; startEvents: show"
          animation__float="property: position; to: -0.55 -0.3 0; dir: alternate; dur: 2500; loop: true; easing: easeInOutSine">

          <a-plane color="#222" width="1.3" height="0.35" opacity="0.5" material="side: double"></a-plane>
          <a-plane color="#00FFFF" width="1.34" height="0.39" position="0 0 -0.01"></a-plane>

          <a-text
            data-fulltext="Grande, blanca y redonda, lo miraba desde lo alto con un brillo tan intenso que Mauro sentia que lo estaba juzgando.

—Seguro se rie de mi porque soy pequeño… —pensaba mientras corria a esconderse entre las hojas."
            color="#E0FFFF" align="left" width="1.2" position="-0.6 0.05 0.01"
            font="https://cdn.aframe.io/fonts/DejaVu-sdf.fnt"
          ></a-text>
        </a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 2">
        <a-entity class="text-container" visible="false" opacity="0"
          position="-0.55 -0.35 0"
          animation__fade="property: opacity; to: 1; dur: 1000; easing: easeOutCubic; startEvents: show"
          animation__float="property: position; to: -0.55 -0.3 0; dir: alternate; dur: 2500; loop: true; easing: easeInOutSine">

          <a-plane color="#222" width="1.3" height="0.35" opacity="0.5" material="side: double"></a-plane>
          <a-plane color="#FF69B4" width="1.34" height="0.39" position="0 0 -0.01"></a-plane>

          <a-text
            data-fulltext="3. Una noche, mientras huia apresurado, tropezo con una luciernaga que brillaba tranquilamente sobre una piedra.

—¿Por que corres asi? —pregunto la luciernaga.

—La Luna me mira —susurro Mauro temblando.

La luciernaga solto una risita luminosa.

—¿Y que tiene de malo que alguien te mire? Tal vez no te esta mirando para juzgarte… sino para acompañarte."
            color="#FFE0F0" align="left" width="1.2" position="-0.6 0.05 0.01"
            font="https://cdn.aframe.io/fonts/DejaVu-sdf.fnt"
          ></a-text>
        </a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 3">
        <a-entity class="text-container" visible="false" opacity="0"
          position="-0.55 -0.35 0"
          animation__fade="property: opacity; to: 1; dur: 1000; easing: easeOutCubic; startEvents: show"
          animation__float="property: position; to: -0.55 -0.3 0; dir: alternate; dur: 2500; loop: true; easing: easeInOutSine">

          <a-plane color="#222" width="1.3" height="0.35" opacity="0.5" material="side: double"></a-plane>
          <a-plane color="#98FB98" width="1.34" height="0.39" position="0 0 -0.01"></a-plane>

          <a-text
            data-fulltext="Mauro se quedo pensando. Esa noche decidio no esconderse. Se sento en el pasto y miro hacia el cielo.

La Luna, muy despacio, brillo aun mas fuerte… como si le sonriera.

Y Mauro, por primera vez, le sonrio tambien.

Desde entonces, el pequeño raton siguio sintiendo miedo a veces, pero habia aprendido algo importante:

> La valentia no es no tener miedo… es atreverse a mirar al miedo a los ojos y sonreirle de vuelta."
            color="#E8FFE8" align="left" width="1.2" position="-0.6 0.05 0.01"
            font="https://cdn.aframe.io/fonts/DejaVu-sdf.fnt"
          ></a-text>
        </a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>








