<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }

      /* üìò Cuadro del cuento */
      #menu {
        position: fixed;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 20px;
        border-radius: 15px;
        color: white;
        font-family: sans-serif;
        z-index: 999;
        text-align: center;
        width: 85%;
        max-width: 420px;
        display: none;
      }
      #menu button {
        margin: 5px;
        padding: 8px 15px;
        border: none;
        border-radius: 10px;
        background: #1e90ff;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }
      #menu button:hover { background: #4682b4; }
      #story-box { margin-top: 10px; font-size: 15px; line-height: 1.4; }

      /* üß≠ Mensaje de escaneo */
      #scan-message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.75);
        padding: 12px 18px;
        border-radius: 12px;
        color: white;
        font-family: sans-serif;
        z-index: 1000;
        text-align: center;
      }
      #scan-message img {
        display: block;
        margin: 10px auto 0 auto;
        max-width: 150px;
        border-radius: 8px;
      }

      /* üéÆ Controles del sistema AR */
      #controls {
        position: fixed;
        bottom: 120px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        display: flex;
        gap: 10px;
      }
      #controls button {
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        background: #444;
        color: white;
        cursor: pointer;
      }
      #controls button:hover { background: #666; }
    </style>
  </head>
  <body>
    <!-- üì∑ Mensaje inicial -->
    <div id="scan-message">
      Escanea una de las p√°ginas del cuento para comenzar üìñ
      <img id="scan-image" src="./page1.png" alt="P√°gina del cuento">
    </div>

    <!-- üìò Cuadro del cuento -->
    <div id="menu">
      <div id="story-box"></div>
      <div>
        <button id="btnPrev">‚üµ Anterior</button>
        <button id="btnNext">Siguiente ‚ü∂</button>
      </div>
    </div>

    <!-- üéÆ Controles del sistema AR -->
    <div id="controls">
      <button id="btnStart">‚ñ∑ Start</button>
      <button id="btnPause">‚ùö‚ùö Pause</button>
      <button id="btnStop">‚äò Stop</button>
    </div>

    <!-- üß± Escena A-Frame + MindAR -->
    <a-scene
      mindar-image="imageTargetSrc: ./cuento1.mind; maxTrack: 1"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <!-- Modelos 3D (uno por p√°gina del cuento) -->
        <a-asset-item id="PageModel1" src="./escena1.glb"></a-asset-item>
        <a-asset-item id="PageModel2" src="./escena2.glb"></a-asset-item>
        <a-asset-item id="PageModel3" src="./escena3.glb"></a-asset-item>
        <a-asset-item id="PageModel4" src="./escena4.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- P√°gina 1 -->
      <a-entity id="target-page1" mindar-image-target="targetIndex: 0">
        <a-entity gltf-model="#PageModel1"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>

      <!-- P√°gina 2 -->
      <a-entity id="target-page2" mindar-image-target="targetIndex: 1">
        <a-entity gltf-model="#PageModel2"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>

      <!-- P√°gina 3 -->
      <a-entity id="target-page3" mindar-image-target="targetIndex: 2">
        <a-entity gltf-model="#PageModel3"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>

      <!-- P√°gina 4 -->
      <a-entity id="target-page4" mindar-image-target="targetIndex: 3">
        <a-entity gltf-model="#PageModel4"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.8 0.8 0.8"
          animation__float="property: position; dir: alternate; loop: true; dur: 2500; to: 0 0.2 0">
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      const storyBox = document.querySelector("#story-box");
      const menu = document.querySelector("#menu");
      const scanMessage = document.querySelector("#scan-message");

      const btnNext = document.querySelector("#btnNext");
      const btnPrev = document.querySelector("#btnPrev");

      // üßæ Cuento dividido por p√°ginas
      const storyPages = [
        "P√°gina 1: Hab√≠a una vez, en un mar tranquilo, una peque√±a ballena curiosa que so√±aba con ver el cielo m√°s all√° del horizonte.",
        "P√°gina 2: Cada d√≠a nadaba m√°s lejos, siguiendo los rayos de sol que se filtraban entre las olas. Su madre le dec√≠a: 'El oc√©ano es grande, pero tu sue√±o es a√∫n mayor'.",
        "P√°gina 3: Una ma√±ana encontr√≥ un pulpo sabio, que le ense√±√≥ que el valor no est√° en la distancia recorrida, sino en la aventura de aprender algo nuevo.",
        "P√°gina 4: Y as√≠, la ballena regres√≥ a casa, sabiendo que los sue√±os se cumplen cuando los sigues con el coraz√≥n abierto."
      ];

      let currentPage = 0;
      let arSystem;
      const sceneEl = document.querySelector("a-scene");

      // Mostrar texto
      function showPageText(index) {
        storyBox.innerText = storyPages[index];
        menu.style.display = "block";
        scanMessage.style.display = "none";
      }
      function hideAll() {
        menu.style.display = "none";
        scanMessage.style.display = "block";
      }

      // Detectar targets (p√°ginas)
      document.querySelector("#target-page1").addEventListener("targetFound", () => { currentPage=0; showPageText(0); });
      document.querySelector("#target-page2").addEventListener("targetFound", () => { currentPage=1; showPageText(1); });
      document.querySelector("#target-page3").addEventListener("targetFound", () => { currentPage=2; showPageText(2); });
      document.querySelector("#target-page4").addEventListener("targetFound", () => { currentPage=3; showPageText(3); });

      ["#target-page1","#target-page2","#target-page3","#target-page4"].forEach(id => {
        document.querySelector(id).addEventListener("targetLost", hideAll);
      });

      // Navegaci√≥n manual del cuento
      btnNext.addEventListener("click", ()=>{
        currentPage = (currentPage + 1) % storyPages.length;
        showPageText(currentPage);
      });
      btnPrev.addEventListener("click", ()=>{
        currentPage = (currentPage - 1 + storyPages.length) % storyPages.length;
        showPageText(currentPage);
      });

      // Sistema AR
      sceneEl.addEventListener("loaded", ()=>{ arSystem = sceneEl.systems["mindar-image-system"]; });

      document.querySelector("#btnStart").addEventListener("click", ()=> arSystem.start());
      document.querySelector("#btnPause").addEventListener("click", ()=> arSystem.pause());
      document.querySelector("#btnStop").addEventListener("click", ()=> {
        arSystem.stop();
        hideAll();
      });

      // Rotar im√°genes del mensaje de escaneo
      const scanImage = document.querySelector("#scan-image");
      const scanImages = ["./page1.png","./page2.png","./page3.png","./page4.png"];
      let scanIndex=0;
      setInterval(()=>{
        scanIndex=(scanIndex+1)%scanImages.length;
        scanImage.src=scanImages[scanIndex];
      },2000);
    </script>
  </body>
</html>


